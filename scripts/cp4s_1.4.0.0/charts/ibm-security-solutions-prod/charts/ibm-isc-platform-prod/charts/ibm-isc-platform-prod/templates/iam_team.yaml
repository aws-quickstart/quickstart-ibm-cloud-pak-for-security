# Creates Security Connect Team in IBM Cloud Private IAM to allow login
apiVersion: isc.ibm.com/v1
kind: ISCComponent
metadata:
  name: iam-apikey
  labels:
    app.kubernetes.io/name: {{ .Chart.Name }}
    helm.sh/chart: {{ .Chart.Name }}-{{ .Chart.Version | replace "+" "_" }}
    release: {{ .Release.Name }}
    app.kubernetes.io/instance: default
    app.kubernetes.io/managed-by: {{ .Release.Service }}
spec:
  action:
    name: create iam apikey
    operation: iam_apikey
    apikey_name: connect-idmgmt-apikey
    iam_service_id:
      name: cp4s-idmgt-service-id
      description: "Enable Cloud Pak For Security services to execute /idmgmt APIs"
      roles: "ClusterAdministrator"
      service_names:
        - idmgmt
        - identity
